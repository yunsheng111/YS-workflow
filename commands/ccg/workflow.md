---
description: '多模型协作开发工作流（研究→构思→计划→执行→审查与修复→验收），智能路由前端→Gemini、后端→Codex'
---

# Workflow - 多模型协作开发

使用质量把关、MCP 服务和多模型协作执行结构化开发工作流。

## 使用方法

```bash
/workflow <任务描述>
```

---

## Level 1: 智能路由层

### 步骤 1：增强需求
调用 `mcp______enhance` 将用户需求转化为结构化技术问题：
- 明确目标、范围、技术约束、验收标准
- 降级链：`mcp__ace-tool__enhance_prompt` → Claude 自增强

### 步骤 2：推荐命令
基于增强后的需求，智能推荐执行方案：
- 分析任务目标、涉及模块和技术领域
- 推荐至少一个 CCG 命令（如需要可推荐多命令串行/并行）
- 确定执行方式：串行（存在依赖）或并行（文件范围可隔离）
- 为每个推荐命令附带理由说明

### 步骤 3：用户确认
使用 `mcp______zhi` 展示推荐方案，等待用户确认：
- 确认选项：["执行推荐方案", "调整命令组合", "修改需求", "取消"]

### 步骤 4：上下文检索
确认后、进入 Level 2 前，调用 `mcp__ace-tool__search_context` 获取相关上下文：
- 降级链：`mcp______sou` → Grep/Glob

### ⛔ 硬门禁
**未完成 Level 1 禁止进入 Level 2**。必须完成 enhance + 命令推荐 + 用户确认 + 上下文检索。

---

## Level 2: 命令层执行

**执行方式**：Task 调用代理

**代理**：`fullstack-agent`

**调用**：
```
Task({
  subagent_type: "fullstack-agent",
  prompt: "$ARGUMENTS",
  description: "6 阶段全栈开发"
})
```

---

## Level 3: 工具层执行

**代理调用的工具**：
- 代码检索：`mcp__ace-tool__search_context`
- 多模型调用：Codex（后端）+ Gemini（前端）
- 用户确认：`mcp______zhi`
- 知识存储：`mcp______ji`
- 浏览器验证：Chrome DevTools MCP

**详细说明**：参考 [fullstack-agent.md](../../agents/ccg/fullstack-agent.md)

> 仅列关键工具，完整清单见代理文件

---

## 执行流程（概述）

fullstack-agent 将执行以下 6 阶段工作流：

1. **研究与分析** — Prompt 增强 + 上下文检索 + 需求评分
2. **方案构思** — 多模型并行分析 + 方案对比
3. **详细规划** — 多模型协作规划 + 用户确认
4. **实施** — 代码开发 + Chrome DevTools 验证
5. **审查与修复** — 多模型并行审查 + 问题修复
6. **验收** — 最终评估 + 用户确认

**可选后续动作**：创建 GitHub PR

---

## 关键规则

1. **委托给 fullstack-agent** — 主代理只需调用 Task 工具
2. **代码主权** — 外部模型零写入权限，所有修改由 Claude 执行
3. **止损机制** — 当前阶段输出通过验证前，不进入下一阶段
4. **阶段顺序不可跳过** — 严格执行 6 阶段工作流
