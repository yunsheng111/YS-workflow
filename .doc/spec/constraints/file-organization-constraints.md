---
version: v1.0
timestamp: 2026-02-13T07:30:00Z
task: "统一研究、分析、规划等临时文件的组织结构"
---

# 约束集：文件组织规范统一

## 硬约束（Hard Constraints）

### HC-1: 路径引用兼容性
- **描述**：所有现有工具和代理对路径的引用必须保持有效，不能因路径变更导致功能失效
- **验证方式**：
  1. 扫描所有 `.md` 文件中的路径引用（`.claude/spec/`、`.claude/team-plan/`、`.claude/plan/`）
  2. 验证迁移后路径是否在代码中被正确更新
  3. 运行所有 CCG 命令测试路径访问
- **违反后果**：CCG 命令执行失败、代理无法读取约束集/计划文件、工作流中断

### HC-2: Git 规范合规性
- **描述**：新路径结构必须符合 Git 规范，且与 `.gitignore` 配置协调
- **验证方式**：
  1. 检查 `.gitignore` 中的路径排除规则
  2. 验证临时文件是否被正确忽略
  3. 确认需要版本控制的文件未被误排除
- **违反后果**：敏感数据泄露、临时文件污染仓库、版本控制混乱

### HC-3: 目录结构层级限制
- **描述**：目录层级不超过 4 层，避免路径过长导致 Windows 系统兼容性问题
- **验证方式**：
  1. 统计所有路径的层级深度
  2. 检查是否存在超过 4 层的嵌套
  3. 验证 Windows 路径长度限制（MAX_PATH = 260）
- **违反后果**：Windows 系统无法访问深层文件、路径截断错误

### HC-4: 向后兼容性保证
- **描述**：迁移过程必须提供过渡期，旧路径在至少一个版本周期内保持可访问（通过符号链接或重定向）
- **验证方式**：
  1. 创建旧路径到新路径的映射表
  2. 验证旧路径访问是否能正确重定向
  3. 检查是否有弃用警告提示
- **违反后果**：用户现有工作流中断、历史文档失效、迁移成本激增

### HC-5: 文件类型隔离
- **描述**：不同生命周期的文件必须物理隔离（临时文件、归档文件、模板文件）
- **验证方式**：
  1. 检查临时文件是否混入归档目录
  2. 验证模板文件是否被误修改
  3. 确认各目录职责单一
- **违反后果**：文件误删、模板污染、归档混乱

### HC-6: 工具集成约束
- **描述**：路径变更不能破坏 MCP 工具（ace-tool、三术记忆、Grok Search）的缓存和索引机制
- **验证方式**：
  1. 检查 `.ace-tool/` 缓存是否需要重建
  2. 验证 `.sanshu-memory/` 记忆索引是否失效
  3. 测试 MCP 工具的文件检索功能
- **违反后果**：工具性能下降、缓存失效、检索结果不准确

## 软约束（Soft Constraints）

### SC-1: 语义清晰性
- **描述**：目录和文件命名应清晰表达其用途，避免缩写和模糊术语
- **优先级**：P0（立即）
- **权衡考虑**：如果路径过长影响可读性，可使用约定俗成的缩写（如 `spec` 代替 `specification`）

### SC-2: 扁平化优先
- **描述**：优先使用扁平化结构，减少不必要的嵌套层级
- **优先级**：P1（短期）
- **权衡考虑**：当文件数量超过 20 个时，可适当增加一层分类目录

### SC-3: 时间戳命名规范
- **描述**：临时文件应包含时间戳或版本号，便于追溯和清理
- **优先级**：P1（短期）
- **权衡考虑**：如果文件生命周期短（< 1 天），可省略时间戳

### SC-4: 自动化清理支持
- **描述**：临时文件目录应支持自动化清理脚本（按时间、大小、数量）
- **优先级**：P2（中期）
- **权衡考虑**：如果用户需要手动管理临时文件，可延后实施

### SC-5: 文档自描述性
- **描述**：每个目录应包含 README.md 说明其用途、文件格式、清理策略
- **优先级**：P0（立即）
- **权衡考虑**：对于职责明确的目录（如 `templates/`），可简化文档

## 依赖关系（Dependencies）

### DEP-1: CCG 命令路径依赖
- **类型**：技术依赖
- **描述**：25 个 CCG 命令文件中硬编码了路径引用，必须同步更新
- **影响范围**：
  - `commands/ccg/spec-*.md`（5 个文件）
  - `commands/ccg/team-*.md`（4 个文件）
  - `commands/ccg/plan.md`、`commands/ccg/feat.md`
  - 所有引用 `.claude/spec/`、`.claude/team-plan/`、`.claude/plan/` 的命令

### DEP-2: 代理配置依赖
- **类型**：技术依赖
- **描述**：12 个代理文件中定义了输入/输出路径，必须同步更新
- **影响范围**：
  - `agents/ccg/spec-*-agent.md`（5 个文件）
  - `agents/ccg/planner.md`、`agents/ccg/execute-agent.md`
  - `agents/ccg/fullstack-agent.md`、`agents/ccg/frontend-agent.md`、`agents/ccg/backend-agent.md`

### DEP-3: .gitignore 配置依赖
- **类型**：数据依赖
- **描述**：`.gitignore` 中已配置 `plan/` 目录忽略规则，新路径需同步更新
- **影响范围**：
  - `.gitignore` 第 23 行
  - 可能影响 Git 版本控制行为

### DEP-4: 用户习惯依赖
- **类型**：时序依赖
- **描述**：用户可能已在本地脚本、文档、书签中引用旧路径
- **影响范围**：
  - 用户自定义脚本
  - 外部文档链接
  - IDE 配置文件

## 风险（Risks）

### RISK-1: 迁移过程中的数据丢失
- **描述**：文件移动过程中可能因操作失误导致数据丢失
- **概率**：中
- **影响**：高
- **缓解措施**：
  1. 迁移前完整备份 `.claude/` 目录
  2. 使用 Git 版本控制追踪变更
  3. 提供回滚脚本
  4. 分阶段迁移，每阶段验证后再继续

### RISK-2: 路径引用遗漏导致功能失效
- **描述**：可能存在未被扫描到的路径引用（如动态拼接路径、注释中的示例）
- **概率**：高
- **影响**：中
- **缓解措施**：
  1. 使用正则表达式全局搜索所有路径模式
  2. 在测试环境完整运行所有 CCG 命令
  3. 提供路径映射表供用户手动检查
  4. 保留旧路径符号链接至少一个版本周期

### RISK-3: 工具缓存失效导致性能下降
- **描述**：路径变更可能导致 ace-tool、三术记忆等工具的缓存失效，需要重建索引
- **概率**：高
- **影响**：中
- **缓解措施**：
  1. 迁移后主动触发缓存重建
  2. 提供缓存清理脚本
  3. 在文档中说明性能恢复时间
  4. 考虑增量更新缓存而非全量重建

### RISK-4: 多人协作冲突
- **描述**：如果多人同时在不同分支工作，路径变更可能导致合并冲突
- **概率**：低
- **影响**：中
- **缓解措施**：
  1. 在主分支完成迁移后通知所有协作者
  2. 提供迁移指南和自动化脚本
  3. 建议协作者在迁移完成前暂停提交
  4. 使用 Git rebase 而非 merge 减少冲突

### RISK-5: Windows 路径长度限制
- **描述**：新路径可能因嵌套层级增加导致超过 Windows MAX_PATH（260 字符）限制
- **概率**：低
- **影响**：高
- **缓解措施**：
  1. 设计路径时控制总长度 < 200 字符
  2. 使用短命名（如 `wip/` 代替 `work-in-progress/`）
  3. 在 Windows 系统测试所有路径
  4. 提供长路径支持配置指南（启用 LongPathsEnabled）

---

## 当前文件分布统计

### 混乱表现

1. **多个临时目录并存**：
   - `.claude/spec/`：OpenSpec 约束集、提案、计划（标准化）
   - `.claude/team-plan/`：Agent Teams 研究文档（6 个文件，~103KB）
   - `.claude/plan/`：空目录（已在 .gitignore 中忽略）
   - `plan/`：根目录下的计划文件（1 个文件）

2. **命名不一致**：
   - 研究文件：`*-research.md`、`*-analysis.md`
   - 计划文件：`*-plan.md`、`*-upgrade-plan.md`
   - 实施文件：`*-implementation.md`

3. **生命周期混淆**：
   - 临时研究文件与归档文件混在同一目录
   - 无明确的清理策略

### 文件统计

| 目录 | 文件数 | 总大小 | 文件类型 |
|------|--------|--------|----------|
| `.claude/spec/` | 16 | ~70KB | 约束集、提案、计划、模板 |
| `.claude/team-plan/` | 6 | ~103KB | 研究、分析、实施文档 |
| `.claude/plan/` | 0 | 0 | 空目录 |
| `plan/` | 1 | 未知 | 计划文档 |
| **总计** | **23** | **~173KB** | - |

### 路径引用统计

| 路径模式 | 引用次数 | 主要文件 |
|----------|----------|----------|
| `.claude/spec/` | 66 | commands/ccg/*.md, agents/ccg/*.md |
| `.claude/team-plan/` | 0 | 无（仅文件存在） |
| `.claude/plan/` | 12 | commands/ccg/plan.md, agents/ccg/planner.md |

---

## 约束编号规则

- **HC-N**：硬约束，从 HC-1 开始递增
- **SC-N**：软约束，从 SC-1 开始递增
- **DEP-N**：依赖关系，从 DEP-1 开始递增
- **RISK-N**：风险，从 RISK-1 开始递增

## 使用说明

1. 此约束集为 `file-organization-proposal.md` 提案的基础
2. 所有方案设计必须满足硬约束（HC-*）
3. 软约束（SC-*）按优先级权衡
4. 依赖关系（DEP-*）决定迁移顺序
5. 风险（RISK-*）需在提案中提供缓解措施
